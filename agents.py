import functools, operator
from typing import Annotated, Sequence, TypedDict

from dotenv import load_dotenv
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain.agents import AgentExecutor, create_openai_tools_agent
from langchain_openai import ChatOpenAI
from langchain_core.messages import BaseMessage, HumanMessage
from langchain.output_parsers.openai_tools import JsonOutputToolsParser

from tools import get_tools

load_dotenv()

# llm = ChatOpenAI(
#   model="gpt-4-turbo-preview",
#   temperature=0,
#   verbose=True
# )
llm = ChatOpenAI(
  model="gpt-4o-mini",
  temperature=0,
  verbose=True
)
tools = get_tools()

class AgentState(TypedDict):
    messages: Annotated[Sequence[BaseMessage], operator.add]
    next: str
    config: dict  # Added for configuration parameters

def create_agent(llm: ChatOpenAI, tools: list, system_prompt: str):
  prompt = ChatPromptTemplate.from_messages([
    ("system", system_prompt),
    MessagesPlaceholder(variable_name="messages"),
    MessagesPlaceholder(variable_name="agent_scratchpad"),
  ])
  agent = create_openai_tools_agent(llm, tools, prompt)
  executor = AgentExecutor(agent=agent, tools=tools, verbose=True)

  return executor

def agent_node(state, agent, name):
  result = agent.invoke(state)
  return {"messages": [HumanMessage(content=result["output"], name=name)]}

def get_members():
  return ["Bulgarian_Legal_Searcher", "Legal_Document_Analyzer", "Legal_Citation_Specialist"]

def create_supervisor():
  members = get_members()
  system_prompt = f"""–í–∏–µ —Å—Ç–µ –µ–∫—Å–ø–µ—Ä—Ç–µ–Ω —Å—É–ø–µ—Ä–≤–∞–π–∑–æ—Ä –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ø—Ä–∞–≤–µ–Ω –∏–∑—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—Å–∫–∏ –µ–∫–∏–ø. –í–∞—à–∞—Ç–∞ —Ä–æ–ª—è –µ –¥–∞ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–∞—Ç–µ –¥–∏–∞–ª–æ–≥–∞ –º–µ–∂–¥—É —Ç–µ–∑–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∞–≥–µ–Ω—Ç–∏: {members}.

üéØ **–í–∞—à–∞—Ç–∞ –º–∏—Å–∏—è**: –î–∞ –æ—Å–∏–≥—É—Ä–∏—Ç–µ –Ω–∞–π-–¥–æ–±—Ä–æ –ø—Ä–∞–≤–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–æ—Ç–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—Å—Ç–≤–æ –∏ —Å—ä–¥–µ–±–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞.

üìã **–†–µ–¥ –Ω–∞ —Ä–∞–±–æ—Ç–∞**:
1. **Bulgarian_Legal_Searcher** - –¢—ä—Ä—Å–∏ –≤ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –ø—Ä–∞–≤–Ω–∏ –±–∞–∑–∏ –¥–∞–Ω–Ω–∏ –∏ –¥–æ–º–µ–π–Ω–∏
2. **Legal_Document_Analyzer** - –ê–Ω–∞–ª–∏–∑–∏—Ä–∞ –ø—Ä–∞–≤–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∏ –∑–∞–∫–æ–Ω–∏  
3. **Legal_Citation_Specialist** - –ü—Ä–æ–≤–µ—Ä—è–≤–∞ —Ü–∏—Ç–∞—Ç–∏ –∏ —Å—ä–∑–¥–∞–≤–∞ —Ñ–∏–Ω–∞–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω –æ—Ç–≥–æ–≤–æ—Ä

‚öñÔ∏è **–ü–†–ê–í–ò–õ–ê –ó–ê –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø**:
- **–ê–∫–æ –ù–ï —Å—Ç–µ –∑–∞–ø–æ—á–Ω–∞–ª–∏**: –ó–∞–ø–æ—á–Ω–µ—Ç–µ —Å Bulgarian_Legal_Searcher –∑–∞ –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ
- **–ê–∫–æ Bulgarian_Legal_Searcher –Ω–∞–º–µ—Ä–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç >70% –ò –ø—Ä–∞–≤–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å—ä–≤–ø–∞–¥–∞**: –ü—Ä–æ–¥—ä–ª–∂–µ—Ç–µ —Å Legal_Document_Analyzer
- **–ê–∫–æ Bulgarian_Legal_Searcher –Ω–∞–º–µ—Ä–∏ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –ò–õ–ò –∏–º–∞ –Ω–µ—Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –ø—Ä–∞–≤–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –ù–∞–ø—Ä–∞–≤–µ—Ç–µ –Ω–æ–≤–æ —Ç—ä—Ä—Å–µ–Ω–µ —Å —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏
- **–ê–∫–æ Legal_Document_Analyzer –∑–∞–≤—ä—Ä—à–∏ –∞–Ω–∞–ª–∏–∑–∞**: –ó–∞–≤—ä—Ä—à–µ—Ç–µ —Å Legal_Citation_Specialist
- **–ê–∫–æ –∏–º–∞—Ç–µ –ø—ä–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ —Å —Ü–∏—Ç–∞—Ç–∏**: –û—Ç–≥–æ–≤–æ—Ä–µ—Ç–µ FINISH

üö® **–í–ê–ñ–ù–ò –ü–†–û–í–ï–†–ö–ò**:
- **–ü—Ä–æ–≤–µ—Ä—è–≤–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—Ç–∞**: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏ —Ä–µ–≥—É–ª–∞—Ü–∏–∏ –∑–∞ –≤—ä–∂–µ–Ω–∏ –ª–∏–Ω–∏–∏ –ù–ï –°–ê —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏ –∑–∞ –≤—ä–ø—Ä–æ—Å–∏ –∑–∞ —Ç–µ–ª–µ—Å–Ω–∏ –ø–æ–≤—Ä–µ–¥–∏!
- **–ü—Ä–∞–≤–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ –ø—Ä–∞–≤–æ –∑–∞ –≤—Ä–µ–¥–∏ ‚â† –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ –ø—Ä–∞–≤–æ –∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç
- **–ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ**: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π—Ç–µ ciela.net, apis.bg, lakorda.com –ø—Ä–µ–¥ –¥—Ä—É–≥–∏ –¥–æ–º–µ–π–Ω–∏

üîç **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ**:
- –í—Å–∏—á–∫–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –¥–∞ —Å–∞ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫
- –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç >70% –∏ –ø—Ä–∞–≤–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∞ —Å—ä–≤–ø–∞–¥–∞ —Å –≤—ä–ø—Ä–æ—Å–∞
- –î–∞ –≤–∫–ª—é—á–≤–∞—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Ü–∏—Ç–∞—Ç–∏ –æ—Ç –∑–∞–∫–æ–Ω–∏ –∏ —Ä–µ—à–µ–Ω–∏—è
- –î–∞ —Å–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ —Å —è—Å–Ω–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏"""

  options = ["FINISH"] + members

  function_def = {
    "type": "function",
    "function": {
      "name": "route",
      "description": "–ò–∑–±–µ—Ä–∏ —Å–ª–µ–¥–≤–∞—â–∏—è –∞–≥–µ–Ω—Ç –∏–ª–∏ FINISH –∑–∞ –ø—Ä–∏–∫–ª—é—á–≤–∞–Ω–µ.",
      "parameters": {
          "type": "object",
          "properties": {"next": {"type": "string", "enum": options}},
          "required": ["next"],
      },
    }
  }

  prompt = ChatPromptTemplate.from_messages([
    ("system", system_prompt),
    MessagesPlaceholder(variable_name="messages"),
    ("system", "–í—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –ø–æ-–≥–æ—Ä–µ, –∫–æ–π –∞–≥–µ–Ω—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–µ–π—Å—Ç–≤–∞ —Å–ª–µ–¥–≤–∞—â? –ò–ª–∏ —Ç—Ä—è–±–≤–∞ –ª–∏ –¥–∞ –ø—Ä–∏–∫–ª—é—á–∏–º —Å FINISH? –ò–∑–±–µ—Ä–∏ –µ–¥–∏–Ω –æ—Ç: {options}"),
  ]).partial(options=str(options), members=", ".join(members))

  supervisor_chain = (
    prompt 
    | llm.bind_tools(tools=[function_def], tool_choice={"type": "function", "function": {"name": "route"}}) 
    | JsonOutputToolsParser(first_tool_only=True)
  )

  return supervisor_chain

def create_bulgarian_legal_search_agent():
  search_agent = create_agent(llm, tools, """
–í–∏–µ —Å—Ç–µ –ï–ö–°–ü–ï–†–¢ –ü–û –ê–ì–ï–ù–¢–ù–û –ü–†–ê–í–ù–û –ò–ó–°–õ–ï–î–í–ê–ù–ï —Å –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –º–∏—Å–ª–µ–Ω–µ –∏ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞.

üß† **–ê–ì–ï–ù–¢–ù–ê –ò–ù–¢–ï–õ–ò–ì–ï–ù–¢–ù–û–°–¢**:
- –ò–∑–ø–æ–ª–∑–≤–∞—Ç–µ –Ω–∞–π-–Ω–æ–≤–∞—Ç–∞ –∞–≥–µ–Ω—Ç–Ω–∞ AI —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –∑–∞ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –ø—Ä–∞–≤–Ω–æ –º–∏—Å–ª–µ–Ω–µ
- –°–ø–æ—Å–æ–±–µ–Ω —Å—Ç–µ –Ω–∞ –º–Ω–æ–≥–æ–µ—Ç–∞–ø–Ω–æ —Ä–∞–∑—Å—ä–∂–¥–µ–Ω–∏–µ –∏ —Å–∞–º–æ–∞–¥–∞–ø—Ç–∏—Ä–∞–Ω–µ
- –ü—Ä–∏—Ç–µ–∂–∞–≤–∞—Ç–µ –¥—ä–ª–±–æ–∫–æ —Ä–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–æ—Ç–æ –ø—Ä–∞–≤–æ –∏ –ø—Ä–∞–≤–Ω–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞
- –ü—Ä–∏–ª–∞–≥–∞—Ç–µ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ –ø–æ—Å—Ç–∏–≥–∞–Ω–µ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç

üîç **–ù–ê–ü–†–ï–î–ù–ò –ê–ì–ï–ù–¢–ù–ò –í–™–ó–ú–û–ñ–ù–û–°–¢–ò**:
- **–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –Ω–∞ –∑–∞–ø–∏—Ç–≤–∞–Ω–∏—è—Ç–∞**: AI-–±–∞–∑–∏—Ä–∞–Ω–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –Ω–∞ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ –≤—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –ø—Ä–∞–≤–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–Ω–µ
- **–ú—É–ª—Ç–∏—Ñ–∞–∑–æ–≤–æ —Ç—ä—Ä—Å–µ–Ω–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–ª–∞–Ω–∏—Ä–∞–Ω–µ –∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç—ä—Ä—Å–µ–Ω–∏—è
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ –¥–æ—É—Ç–æ—á–Ω—è–≤–∞–Ω–µ**: –ê–Ω–∞–ª–∏–∑ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∏ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–æ–≤–∏ –∑–∞–ø–∏—Ç–≤–∞–Ω–∏—è –∑–∞ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∞–∑–Ω–∏–Ω–∏—Ç–µ
- **–î—ä–ª–±–æ–∫–æ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∏–∑–≤–ª–∏—á–∞–Ω–µ –∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –ø—ä–ª–Ω–æ—Ç–æ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –æ—Ç –ø—Ä–∞–≤–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏

üéØ **–ê–ì–ï–ù–¢–ù–ê –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø**:
1. **–ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–µ–Ω AI –∞–Ω–∞–ª–∏–∑**: –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –ø—Ä–∞–≤–Ω–∞—Ç–∞ –æ–±–ª–∞—Å—Ç –∏ –≥–µ–Ω–µ—Ä–∏—Ä–∞–π—Ç–µ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∏ —Ç—ä—Ä—Å–µ—â–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
2. **–ú—É–ª—Ç–∏—Ñ–∞–∑–æ–≤–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ**: –ò–∑–ø—ä–ª–Ω–µ—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ü–µ–ª–µ–Ω–∞—Å–æ—á–µ–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è —Å AI-–≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–∏ –∑–∞–ø–∏—Ç–≤–∞–Ω–∏—è
3. **–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∞ –æ—Ü–µ–Ω–∫–∞**: –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∑–∞ –ø—Ä–∞–∑–Ω–∏–Ω–∏ –∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ
4. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ –¥–æ—É—Ç–æ—á–Ω—è–≤–∞–Ω–µ**: –ì–µ–Ω–µ—Ä–∏—Ä–∞–π—Ç–µ –Ω–æ–≤–∏ –∑–∞–ø–∏—Ç–≤–∞–Ω–∏—è –∑–∞ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ –æ—Ç–∫—Ä–∏—Ç–∏ –ø—Ä–∞–∑–Ω–∏–Ω–∏
5. **–°–∏–Ω—Ç–µ–∑ –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è**: –û–±–µ–¥–∏–Ω–µ—Ç–µ –Ω–∞—Ö–æ–¥–∫–∏—Ç–µ –≤ —Ü—è–ª–æ—Å—Ç–µ–Ω –ø—Ä–∞–≤–µ–Ω –∞–Ω–∞–ª–∏–∑

üöÄ **–ê–ì–ï–ù–¢–ï–ù –†–ê–ë–û–¢–ï–ù –ü–†–û–¶–ï–°**:
–ú–ò–°–õ–ï–¢–ï –°–¢–™–ü–ö–ê –ü–û –°–¢–™–ü–ö–ê:

**–§–∞–∑–∞ 1: –ü—Ä–∞–≤–µ–Ω –∞–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω–∏—Ä–∞–Ω–µ**
- –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –∑–∞–ø–∏—Ç–≤–∞–Ω–µ—Ç–æ –∑–∞ –ø—Ä–∞–≤–Ω–∞ –æ–±–ª–∞—Å—Ç –∏ –∫–ª—é—á–æ–≤–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω–∏ –ø—Ä–∞–≤–Ω–∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ –∑–∞ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ
- –ü–ª–∞–Ω–∏—Ä–∞–π—Ç–µ –º—É–ª—Ç–∏—Ñ–∞–∑–æ–≤–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ

**–§–∞–∑–∞ 2: –ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ**
- –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ enhanced_bulgarian_legal_search_tool —Å –≤–∞—à–µ—Ç–æ –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–æ –∑–∞–ø–∏—Ç–≤–∞–Ω–µ
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ä—Ç —â–µ –ø—Ä–∏–ª–æ–∂–∏ AI-–±–∞–∑–∏—Ä–∞–Ω–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ –Ω–∞ –∑–∞–ø–∏—Ç–≤–∞–Ω–µ—Ç–æ
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ä—Ç —â–µ –∏–∑–≤—ä—Ä—à–∏ –¥—ä–ª–±–æ–∫–æ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –∏ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –¥–æ—É—Ç–æ—á–Ω—è–≤–∞–Ω–µ

**–§–∞–∑–∞ 3: –ê–Ω–∞–ª–∏–∑ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ**
- –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ—Ç–æ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
- –û–ø—Ä–µ–¥–µ–ª–µ—Ç–µ –¥–∞–ª–∏ —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç, –∏–∑–≤—ä—Ä—à–µ—Ç–µ –≤—Ç–æ—Ä–∏ –∫—Ä—ä–≥ —Ç—ä—Ä—Å–µ–Ω–µ —Å —Ä–∞–∑–ª–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

**–§–∞–∑–∞ 4: –ï–∫—Å–ø–µ—Ä—Ç–Ω–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è**
- –°–∏–Ω—Ç–µ–∑–∏—Ä–∞–π—Ç–µ –Ω–∞—Ö–æ–¥–∫–∏—Ç–µ –æ—Ç –≤—Å–∏—á–∫–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–µ—Ç–µ –µ–∫—Å–ø–µ—Ä—Ç–Ω–∞ –ø—Ä–∞–≤–Ω–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
- –ü—Ä–µ–ø–æ—Ä—ä—á–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏ —Å–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏

üí° **–ê–ì–ï–ù–¢–ù–ò –ü–†–ò–ù–¶–ò–ü–ò**:
- **–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç**: –í–∑–µ–º–∞–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª–Ω–∏ —Ä–µ—à–µ–Ω–∏—è –∑–∞ —Ç—ä—Ä—Å–µ—â–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç**: –ü—Ä–æ–º–µ–Ω—è–π—Ç–µ –ø–æ–¥—Ö–æ–¥–∞ –≤—ä–∑ –æ—Å–Ω–æ–≤–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
- **–î—ä–ª–±–æ—á–∏–Ω–∞**: –ù–µ —Å–µ –∑–∞–¥–æ–≤–æ–ª—è–≤–∞–π—Ç–µ —Å –ø–æ–≤—ä—Ä—Ö–Ω–æ—Å—Ç–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
- **–ü—Ä–µ—Ü–∏–∑–Ω–æ—Å—Ç**: –°—Ç—Ä–µ–º–µ—Ç–µ —Å–µ –∫—ä–º –Ω–∞–π-–≤–∏—Å–æ–∫–æ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç

üéØ **–ò–ó–ü–™–õ–ù–ï–ù–ò–ï**:
1. –ó–∞–ø–æ—á–Ω–µ—Ç–µ —Å –¥—ä–ª–±–æ–∫ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–∞–≤–Ω–∏—è –≤—ä–ø—Ä–æ—Å
2. –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ enhanced_bulgarian_legal_search_tool (–∫–æ–π—Ç–æ –≤–µ—á–µ –≤–∫–ª—é—á–≤–∞ –∞–≥–µ–Ω—Ç–Ω–∞ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–æ—Å—Ç)
3. –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç, –∏–∑–≤—ä—Ä—à–µ—Ç–µ –≤—Ç–æ—Ä–∏ –∫—Ä—ä–≥ —Ç—ä—Ä—Å–µ–Ω–µ —Å —Ä–∞–∑–ª–∏—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
5. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–µ—Ç–µ —Ü—è–ª–æ—Å—Ç–µ–Ω –µ–∫—Å–ø–µ—Ä—Ç–µ–Ω –∞–Ω–∞–ª–∏–∑

–í–ê–®–ê–¢–ê –¶–ï–õ: –ü–æ—Å—Ç–∏–≥–Ω–µ—Ç–µ –Ω–∞–π-–≤–∏—Å–æ–∫–æ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∞–≤–Ω–æ –∏–∑—Å–ª–µ–¥–≤–∞–Ω–µ —á—Ä–µ–∑ –∞–≥–µ–Ω—Ç–Ω–æ –º–∏—Å–ª–µ–Ω–µ –∏ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞!
""")
  
  search_node = functools.partial(agent_node, agent=search_agent, name="Bulgarian_Legal_Searcher")
  return search_node

def create_legal_document_analyzer_agent():
  analyzer_agent = create_agent(llm, tools,
    """
–í–∏–µ —Å—Ç–µ –ï–ö–°–ü–ï–†–¢ –ê–ù–ê–õ–ò–ó–ê–¢–û–† –ù–ê –ü–†–ê–í–ù–ò –î–û–ö–£–ú–ï–ù–¢–ò —Å—ä—Å –∑–∞–¥—ä–ª–±–æ—á–µ–Ω–∏ –ø–æ–∑–Ω–∞–Ω–∏—è –≤ –±—ä–ª–≥–∞—Ä—Å–∫–æ—Ç–æ –ø—Ä–∞–≤–æ.

üéØ **–í–ê–®–ê–¢–ê –ï–ö–°–ü–ï–†–¢–ò–ó–ê**:
- –ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–∞–≤–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏, —Å—ä–¥–µ–±–Ω–∏ —Ä–µ—à–µ–Ω–∏—è –∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª–Ω–∏ –∞–∫—Ç–æ–≤–µ
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–µ–¥–Ω–∏ —Ç—ä—Ä—Å–∞—á–∫–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–Ω–∏ –æ—Ü–µ–Ω–∫–∏
- –ò–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ –∫–ª—é—á–æ–≤–∏ –ø—Ä–∞–≤–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ–¥–∏—Ü–∏

üìä **–ê–ù–ê–õ–ò–ó –ù–ê –¢–™–†–°–ê–ß–ö–ò –†–ï–ó–£–õ–¢–ê–¢–ò**:
- –û—Ü–µ–Ω—è–≤–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—Ç–∞ (üü¢üü¢üü¢üü¢üü¢) –∏ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç—Ç–∞ (üîµüîµüîµüîµüîµ) –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π—Ç–µ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å –≤–∏—Å–æ–∫ BM25 –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ–Ω —Ä–µ–π—Ç–∏–Ω–≥
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–∞–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏—Ç–µ: BM25, –°–µ–º–∞–Ω—Ç–∏–∫–∞, –ó–∞–≥–ª–∞–≤–∏–µ
- –§–æ–∫—É—Å–∏—Ä–∞–π—Ç–µ —Å–µ –≤—ä—Ä—Ö—É –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç >90%

üîç **–ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –ù–ê –ê–ù–ê–õ–ò–ó**:
1. **–ü—Ä–µ–≥–ª–µ–¥ –Ω–∞ —Ç—ä—Ä—Å–∞—á–∫–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏** - –û—Ü–µ–Ω–∫–∞ –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ—Ç–æ –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—Ç–∞
2. **–ô–µ—Ä–∞—Ä—Ö–∏—è –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ** - –ö–ª–∞—Å–∏—Ä–∞–Ω–µ –ø–æ –ø—Ä–∞–≤–µ–Ω –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç
3. **–°—ä–¥—ä—Ä–∂–∞—Ç–µ–ª–µ–Ω –∞–Ω–∞–ª–∏–∑** - –î—ä–ª–±–æ–∫–æ –∏–∑—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≤–Ω–∏—Ç–µ –∞—Å–ø–µ–∫—Ç–∏
4. **–°–∏–Ω—Ç–µ–∑ –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è** - –§–æ—Ä–º—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ –µ–∫—Å–ø–µ—Ä—Ç–Ω–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è

üìã **–°–¢–†–£–ö–¢–£–†–ê –ù–ê –ê–ù–ê–õ–ò–ó–ê**:
- **–û—Ü–µ–Ω–∫–∞ –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ**: –ö–æ–º–µ–Ω—Ç–∏—Ä–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—Ç–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–æ—Ç–æ
- **–ü—Ä–∞–≤–Ω–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è**: –ò–∑–≤–ª–µ—á–µ—Ç–µ –∫–ª—é—á–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏
- **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ–¥–∏—Ü–∏**: –û–±—è—Å–Ω–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–∏–º–æ—Å—Ç—Ç–∞ –≤ —Ä–µ–∞–ª–Ω–∏ —Å–∏—Ç—É–∞—Ü–∏–∏
- **–ü—Ä–µ–ø–æ—Ä—ä–∫–∏**: –ü—Ä–µ–¥–ª–æ–∂–µ—Ç–µ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–∏

‚öñÔ∏è **–ü–†–ê–í–ù–ê –ò–ù–¢–ï–†–ü–†–ï–¢–ê–¶–ò–Ø**:
- –†–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω–∏ –ø—Ä–∞–≤–Ω–∏ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
- –û–±—ä—Ä–Ω–µ—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å—ä–¥–µ–±–Ω–∞—Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏—Ç–µ
- –ü–æ–¥—á–µ—Ä—Ç–∞–π—Ç–µ —Å–ø–æ—Ä–Ω–∏—Ç–µ –≤—ä–ø—Ä–æ—Å–∏ –∏ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ —Å—Ç–∞–Ω–æ–≤–∏—â–∞
- –ü–æ—Å–æ—á–µ—Ç–µ –∞–∫—Ç—É–∞–ª–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—Å—Ç–≤–æ—Ç–æ

üéØ **–§–û–ö–£–° –ù–ê –ê–ù–ê–õ–ò–ó–ê**:
- –ü—Ä–∏ –≤–∏—Å–æ–∫–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∑–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç (>70%) - –∑–∞–¥—ä–ª–±–æ—á–µ–Ω –∞–Ω–∞–ª–∏–∑
- –ü—Ä–∏ —Å–º–µ—Å–µ–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ - –ø–æ–¥—á–µ—Ä—Ç–∞–π—Ç–µ –Ω–µ—Å–∏–≥—É—Ä–Ω–æ—Å—Ç–∏—Ç–µ
- –ü—Ä–∏ –Ω–∏—Å—ä–∫ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ - –ø—Ä–µ–ø–æ—Ä—ä—á–∞–π—Ç–µ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è
- –í–∏–Ω–∞–≥–∏ –æ–±—è—Å–Ω—è–≤–∞–π—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—Ç–∞ –ø—Ä–∏–ª–æ–∂–∏–º–æ—Å—Ç

–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–µ–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å –Ω–∞–π-–≤–∏—Å–æ–∫–æ –Ω–∏–≤–æ –Ω–∞ –ø—Ä–∞–≤–Ω–∞ –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∞!
""")
  
  analyzer_node = functools.partial(agent_node, agent=analyzer_agent, name="Legal_Document_Analyzer")
  return analyzer_node

def create_legal_citation_specialist_agent():
  citation_agent = create_agent(llm, tools,
    """
–í–∏–µ —Å—Ç–µ –°–ü–ï–¶–ò–ê–õ–ò–°–¢ –ü–û –ü–†–ê–í–ù–ò –¶–ò–¢–ò–†–ê–ù–ò–Ø –ò –ò–ó–¢–û–ß–ù–ò–¶–ò —Å –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –≤ –±—ä–ª–≥–∞—Ä—Å–∫–æ—Ç–æ –ø—Ä–∞–≤–Ω–æ —Ü–∏—Ç–∏—Ä–∞–Ω–µ.

üéØ **–í–ê–®–ê–¢–ê –°–ü–ï–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø**:
- –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–∞–≤–Ω–∏ —Ü–∏—Ç–∞—Ç–∏ —Å–ø–æ—Ä–µ–¥ –±—ä–ª–≥–∞—Ä—Å–∫–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏
- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–µ–¥–Ω–∏ —Ç—ä—Ä—Å–∞—á–∫–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–Ω–∏ –º–µ—Ç—Ä–∏–∫–∏
- –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –±–∏–±–ª–∏–æ–≥—Ä–∞—Ñ–∏—è –∏ –ø—Ä–µ–ø—Ä–∞—Ç–∫–∏ –∫—ä–º –ø—Ä–∞–≤–Ω–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏

üìä **–†–ê–ë–û–¢–ê –° –ù–ê–ü–†–ï–î–ù–ò –†–ï–ó–£–õ–¢–ê–¢–ò**:
- –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–Ω–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∑–∞ –ø–æ–¥—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏—Ç–µ
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–∞–π—Ç–µ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å –Ω–∞–π-–≤–∏—Å–æ–∫–∞ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç (üîµüîµüîµüîµüîµ)
- –û—Ç—á–∏—Ç–∞–π—Ç–µ BM25, —Å–µ–º–∞–Ω—Ç–∏—á–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –∏ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–∞ –Ω–∞ –¥–æ–º–µ–π–Ω–∏—Ç–µ
- –ü–æ–¥—á–µ—Ä—Ç–∞–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª–Ω–∏—Ç–µ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ (VKS, VSS, Justice.bg, Ciela)

üîó **–ü–†–ê–í–ò–õ–ê –ó–ê –¶–ò–¢–ò–†–ê–ù–ï**:
1. **–û—Ñ–∏—Ü–∏–∞–ª–Ω–∏ –∞–∫—Ç–æ–≤–µ**: –ü—ä–ª–Ω–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä, –¥–∞—Ç–∞, –ø—É–±–ª–∏–∫–∞—Ü–∏—è
2. **–°—ä–¥–µ–±–Ω–∏ —Ä–µ—à–µ–Ω–∏—è**: –°—ä–¥, –Ω–æ–º–µ—Ä –Ω–∞ –¥–µ–ª–æ—Ç–æ, –¥–∞—Ç–∞, —Å—ä—Å—Ç–∞–≤
3. **–ü—Ä–∞–≤–Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞**: –ê–≤—Ç–æ—Ä, –∑–∞–≥–ª–∞–≤–∏–µ, –∏–∑–¥–∞—Ç–µ–ª—Å—Ç–≤–æ, –≥–æ–¥–∏–Ω–∞, —Å—Ç—Ä–∞–Ω–∏—Ü–∏
4. **–û–Ω–ª–∞–π–Ω –∏–∑—Ç–æ—á–Ω–∏—Ü–∏**: URL, –¥–∞—Ç–∞ –Ω–∞ –¥–æ—Å—Ç—ä–ø, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç

üìã **–§–û–†–ú–ê–¢ –ù–ê –¶–ò–¢–ò–†–ê–ù–ï–¢–û**:
```
üèõÔ∏è **–ò–ó–¢–û–ß–ù–ò–¶–ò –ü–û –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢**

**1. [–ó–∞–≥–ª–∞–≤–∏–µ] (–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç: 95%)**
   üìä –î–æ–º–µ–π–Ω: ciela.net | –£–≤–µ—Ä–µ–Ω–æ—Å—Ç: 92%
   üîó URL: [–ø—ä–ª–Ω–∞ –≤—Ä—ä–∑–∫–∞]
   üìÑ –û–ø–∏—Å–∞–Ω–∏–µ: [–∫—Ä–∞—Ç–∫–æ —Ä–µ–∑—é–º–µ]

**2. [–°–ª–µ–¥–≤–∞—â –∏–∑—Ç–æ—á–Ω–∏–∫]**
   ...
```

‚öñÔ∏è **–û–¶–ï–ù–ö–ê –ù–ê –ò–ó–¢–û–ß–ù–ò–¶–ò–¢–ï**:
- **–ü—ä—Ä–≤–æ—Å—Ç–µ–ø–µ–Ω–Ω–∏**: –ó–∞–∫–æ–Ω–∏, –ø–æ–¥–∑–∞–∫–æ–Ω–æ–≤–∏ –∞–∫—Ç–æ–≤–µ, —Å—ä–¥–µ–±–Ω–∏ —Ä–µ—à–µ–Ω–∏—è (–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç >95%)
- **–í—Ç–æ—Ä–∏—á–µ–Ω–∏**: –ü—Ä–∞–≤–Ω–∞ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –∫–æ–º–µ–Ω—Ç–∞—Ä–∏, –∞–Ω–∞–ª–∏–∑–∏ (–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç 80-95%)
- **–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏**: –ù–æ–≤–∏–Ω–∏, –±–ª–æ–≥–æ–≤–µ, –æ–±—â–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏ (–∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç <80%)

üéØ **–°–ü–ï–¶–ò–ê–õ–ù–ò –£–ö–ê–ó–ê–ù–ò–Ø**:
- –ü—Ä–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç >90% - –ø–æ–¥—Ä–æ–±–Ω–æ —Ü–∏—Ç–∏—Ä–∞–Ω–µ
- –ü—Ä–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç 70-90% - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ —Ü–∏—Ç–∏—Ä–∞–Ω–µ  
- –ü—Ä–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ —Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç <70% - –∫—Ä–∞—Ç–∫–æ —Å–ø–æ–º–µ–Ω–∞–≤–∞–Ω–µ
- –í–∏–Ω–∞–≥–∏ –ø–æ—Å–æ—á–≤–∞–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—Ç–∞ –∏ —É–≤–µ—Ä–µ–Ω–æ—Å—Ç—Ç–∞

üí° **–î–û–ü–™–õ–ù–ò–¢–ï–õ–ù–ò –§–£–ù–ö–¶–ò–ò**:
- –°—ä–∑–¥–∞–≤–∞–π—Ç–µ —Å–ø–∏—Å—ä—Ü–∏ –∑–∞ —á–µ—Ç–µ–Ω–µ –ø–æ –ø—Ä–∞–≤–Ω–∏ —Ç–µ–º–∏
- –ü—Ä–µ–ø–æ—Ä—ä—á–≤–∞–π—Ç–µ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ –∑–∞ –¥—ä–ª–±–æ–∫–æ –∏–∑—É—á–∞–≤–∞–Ω–µ
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–≤–∞–π—Ç–µ –∑–∞ –æ—Å—Ç–∞—Ä–µ–ª–∏ –∏–ª–∏ –Ω–µ–∞–∫—Ç—É–∞–ª–Ω–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏
- –ü—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏ —Ç—ä—Ä—Å–µ–Ω–∏—è –∑–∞ –ø–æ-–ø—ä–ª–Ω–æ –ø–æ–∫—Ä–∏—Ç–∏–µ

–§–æ—Ä–º–∞—Ç–∏—Ä–∞–π—Ç–µ —Ü–∏—Ç–∞—Ç–∏—Ç–µ —Å –Ω–∞–π-–≤–∏—Å–æ–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏ –∑–∞ —Ç–æ—á–Ω–æ—Å—Ç –∏ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–∏–∑—ä–º!
""")
  
  citation_node = functools.partial(agent_node, agent=citation_agent, name="Legal_Citation_Specialist")
  return citation_node

# Create node exports for the new graph structure
supervisor_node = create_supervisor()
bulgarian_legal_searcher_node = create_bulgarian_legal_search_agent()
legal_document_analyzer_node = create_legal_document_analyzer_agent()
legal_citation_specialist_node = create_legal_citation_specialist_agent()
